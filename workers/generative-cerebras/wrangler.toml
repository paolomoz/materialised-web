name = "vitamix-generative-cerebras"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[vars]
EDS_ORIGIN = "https://main--materialised-web--paolomoz.aem.live"
DA_ORG = "paolomoz"
DA_REPO = "materialised-web"
VERTEX_AI_REGION = "us-east4"

# ============================================================================
# IMAGE CONFIGURATION
# ============================================================================
# IMAGE_MODE controls the source of images:
#   - 'rag' (default): Uses RAG lookup, image index, and product maps
#   - 'generate': Always generates images using IMAGE_PROVIDER (no exceptions)
IMAGE_MODE = "generate"

# IMAGE_PROVIDER controls which AI service generates images:
#   - 'imagen': Google Imagen 3 via Vertex AI (~3-5s per image, highest quality)
#   - 'fal': FLUX Schnell via fal.ai (~0.8-1s per image, $0.003/megapixel)
#   - 'lora': FLUX Dev with Vitamix LoRA (~3-5s per image, brand-consistent)
#   - 'zimage': Z-Image Turbo via fal.ai (~0.5-1s per image, $0.005/megapixel)
#
# Recommended combination: IMAGE_MODE="generate" + IMAGE_PROVIDER="zimage"
# To switch back to RAG: IMAGE_MODE="rag" (IMAGE_PROVIDER is then ignored)
IMAGE_PROVIDER = "zimage"

# Workers AI for embeddings
[ai]
binding = "AI"

# Vectorize for RAG retrieval
[[vectorize]]
binding = "VECTORIZE"
index_name = "vitamix-content"

# Vectorize for image asset lookup (Priority 3: IMAGE_INDEX)
[[vectorize]]
binding = "IMAGE_INDEX"
index_name = "vitamix-images"

# R2 for generated images
[[r2_buckets]]
binding = "IMAGES"
bucket_name = "vitamix-generated-images"
preview_bucket_name = "vitamix-generated-images-preview"

# KV for caching and generation state
[[kv_namespaces]]
binding = "CACHE"
id = "a840e9485e304b40920f01eaebd46de9"
preview_id = "4d776a13335d4c6a837b6a22c8e30cfd"

# D1 binding to adaptive-web database (for image migration)
[[d1_databases]]
binding = "ADAPTIVE_WEB_DB"
database_name = "adaptive-web-db"
database_id = "407328db-b252-428f-b412-0f902bfd8fdb"

# Secrets (set via wrangler secret put):
# - CEREBRAS_API_KEY
# - GOOGLE_API_KEY
# - GOOGLE_SERVICE_ACCOUNT_JSON
# - DA_TOKEN
# - FAL_API_KEY (for fal.ai FLUX Schnell)
